<template>
  <div class="stage-view">
    <!-- Scrollspy Navigation -->
    <nav class="scrollspy-nav">
      <ul class="nav-list">
        <li>
          <a
            @click="scrollToSection('contexte')"
            :class="{ active: activeSection === 'contexte' }"
            >üéØ Contexte</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('role')"
            :class="{ active: activeSection === 'role' }"
            >üë®‚Äçüíª Mon r√¥le (UE4 - UE5 - UE6)</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('organisation')"
            :class="{ active: activeSection === 'organisation' }"
            >‚è±Ô∏è Organisation</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('technologies')"
            :class="{ active: activeSection === 'technologies' }"
            >üõ†Ô∏è Technologies (UE1)</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('fonctionnalites')"
            :class="{ active: activeSection === 'fonctionnalites' }"
            >‚ö° Fonctionnalit√©s</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('architecture')"
            :class="{ active: activeSection === 'architecture' }"
            >üèóÔ∏è Architecture technique</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('defis')"
            :class="{ active: activeSection === 'defis' }"
            >üîß D√©fis techniques</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('securite')"
            :class="{ active: activeSection === 'securite' }"
            >üõ°Ô∏è S√©curit√© (UE4)</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('avancement')"
            :class="{ active: activeSection === 'avancement' }"
            >üöÄ √âtat d'avancement</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('apprentissages')"
            :class="{ active: activeSection === 'apprentissages' }"
            >üéì Apprentissages</a
          >
        </li>
        <li>
          <a
            @click="scrollToSection('comp√©tences')"
            :class="{ active: activeSection === 'comp√©tences' }"
            >üß† Comp√©tences cibl√©es</a
          >
        </li>
      </ul>
    </nav>

    <!-- 1. Contexte et objectifs -->
    <section id="contexte" class="section">
      <h2>üéØ Contexte et objectifs du projet</h2>
      <p>
        J'ai eu l'opportunit√© de travailler en tant que stagiaire web full-stack
        au Learning Centre Claude Oytana √† Besan√ßon, France, d'avril 2025 √† mai
        2025. Ma mission √©tait de cr√©er une application mobile appel√©e ¬´ Euphron
        ¬ª, permettant aux √©tudiants de l'Universit√© de Franche-Comt√© de donner
        ou de prendre du mat√©riel sportif d'occasion sur un syst√®me de don.
      </p>
      <img src="../assets/Euphron.svg" alt="Logo Euphron" class="logo" />

      <p>
        La r√©alisation de cette application a √©t√© propos√©e par des √©tudiants en
        STAPS, √† la suite d'une √©tude de march√© portant sur l'acc√®s au mat√©riel
        sportif dans leur cursus. Cette √©tude a r√©v√©l√© que, si certaines √©coles
        parviennent √† fournir le mat√©riel n√©cessaire √† leurs √©tudiants, dans de
        nombreuses autres, ce sont les √©tudiants eux-m√™mes qui doivent financer
        leur √©quipement.
      </p>

      <p>
        Le projet s'est d√©velopp√© en parall√®le d'un √©v√©nement existant appel√©
        <strong>"Troc Party sport"</strong> organis√© par la biblioth√®que
        universitaire, o√π un troc √©tait organis√© pendant une journ√©e. L'id√©e
        √©tait de fusionner ces deux initiatives en une seule application
        num√©rique permanente.
      </p>

      <div class="objectives">
        <p>L'objectif √©tait triple :</p>
        <ul>
          <li>
            <strong>Promouvoir l'acc√®s au sport</strong> pour tous les √©tudiants
            en Franche-Comt√©
          </li>
          <li>
            <strong>Encourager la solidarit√© √©tudiante</strong> en facilitant
            l'√©change de mat√©riel
          </li>
          <li>
            <strong>Favoriser la r√©utilisation</strong> dans une d√©marche
            √©coresponsable
          </li>
        </ul>
        <p class="constraint">
          <strong>Contrainte principale :</strong> Aucun gain mon√©taire autoris√©
          - tout devait √™tre gratuit, bas√© sur la solidarit√© √©tudiante.
        </p>
      </div>
    </section>

    <!-- 2. Mon r√¥le et responsabilit√©s -->
    <section id="role" class="section">
      <h2>
        üë®‚Äçüíª Mon r√¥le et responsabilit√©s (<a
          @click="scrollToSection('transverse')"
          class="transverse-link"
          >UE4 - UE5 - UE6</a
        >)
      </h2>
      <p>
        J'ai √©t√© charg√© de r√©aliser
        <strong>l'enti√®ret√© de l'application web</strong>
        (compatible ordinateur et mobile) en totale autonomie. Mes
        responsabilit√©s incluaient :
      </p>
      <ul>
        <li>
          Conception du visuel sur <strong>Figma</strong> pour validation client
        </li>
        <li>D√©veloppement <strong>frontend</strong> (interface utilisateur)</li>
        <li>
          D√©veloppement <strong>backend/serveur</strong> (API et logique m√©tier)
        </li>
        <li>Conception et gestion de la <strong>base de donn√©es</strong></li>
        <li>
          Collaboration avec la <strong>D</strong>irection des
          <strong>S</strong>yst√®mes d'<strong>I</strong>nformation et du
          <strong>N</strong>um√©rique (<strong>DSIN</strong>) pour l'h√©bergement
          futur
        </li>
      </ul>
      <p>
        Cette autonomie m'a permis de prendre des initiatives tout en respectant
        les besoins clients, m√™me lors de changements de sp√©cifications.
      </p>
    </section>

    <!-- 3. Organisation du projet -->
    <section id="organisation" class="section">
      <h2>‚è±Ô∏è Organisation du projet (8 semaines)</h2>
      <div class="timeline">
        <div class="timeline-item">
          <span class="week">Semaines 1-2</span>
          <span class="task"
            >Pr√©paration du visuel et d√©finition des fonctionnalit√©s</span
          >
        </div>
        <div class="timeline-item">
          <span class="week">Semaine 3</span>
          <span class="task"
            >Recherche de technologies et r√©unions de validation</span
          >
        </div>
        <div class="timeline-item">
          <span class="week">Semaines 4-8</span>
          <span class="task"
            >D√©veloppement (frontend, backend, base de donn√©es)</span
          >
        </div>
      </div>

      <p>
        <strong>M√©thodologie :</strong> R√©unions hebdomadaires avec l'√©quipe de
        la BU et mon tuteur de stage. Utilisation de <strong>Git</strong> pour
        le versioning et <strong>Trello</strong> pour la gestion des t√¢ches.
      </p>
    </section>

    <!-- 4. Choix techniques et architecture -->
    <section id="technologies" class="section">
      <h2>
        üõ†Ô∏è Choix techniques et architecture (<a
          @click="scrollToSection('ue1')"
          class="ue1-link"
          >UE1</a
        >)
      </h2>

      <div class="tech-stack">
        <div class="tech-category">
          <h3>Frontend</h3>
          <ul>
            <li>
              <strong>Vue.js 3</strong> - Framework principal (Composition API,
              script setup)
            </li>
            <li>
              <strong>Quasar Framework</strong> - UI framework pour la
              compatibilit√© mobile
            </li>
            <li>
              <strong>Pinia</strong> - Gestion d'√©tat (rempla√ßant de Vuex)
            </li>
            <li>
              <strong>Socket.io-client</strong> - Communication temps r√©el
            </li>
            <li>
              <strong>Capacitor</strong> - Transformation en app mobile native
            </li>
            <li><strong>Axios</strong> - Requ√™tes HTTP</li>
          </ul>
        </div>

        <div class="tech-category">
          <h3>Backend</h3>
          <ul>
            <li>
              <strong>Node.js</strong> - Environnement d'ex√©cution JavaScript
            </li>
            <li><strong>Express.js</strong> - Framework web</li>
            <li><strong>MySQL</strong> - Base de donn√©es relationnelle</li>
            <li>
              <strong>Socket.io</strong> - WebSocket pour le chat temps r√©el
            </li>
            <li>
              <strong>Architecture MVC</strong> - Models, Services, Controllers,
              Routes
            </li>
          </ul>
        </div>
      </div>

      <p>
        <strong>Justification des choix :</strong> J'ai privil√©gi√© Vue.js car je
        ma√Ætrise bien ce framework, contrairement √† Angular ou React. Quasar
        √©tait le choix id√©al pour la compatibilit√© mobile native, r√©pondant
        parfaitement aux exigences du projet.
      </p>
    </section>

    <!-- 5. Fonctionnalit√©s d√©velopp√©es -->
    <section id="fonctionnalites" class="section">
      <h2>‚ö° Fonctionnalit√©s d√©velopp√©es</h2>

      <div class="features-grid">
        <div class="feature-category">
          <h3>Gestion utilisateur</h3>
          <ul>
            <li>Inscription / Connexion</li>
            <li>Modification du profil</li>
            <li>Syst√®me d'authentification</li>
          </ul>
        </div>

        <div class="feature-category">
          <h3>Gestion des articles</h3>
          <ul>
            <li>Ajout d'articles sportifs</li>
            <li>Modification / Suppression</li>
            <li>Syst√®me de cat√©gories</li>
          </ul>
        </div>

        <div class="feature-category">
          <h3>Communication</h3>
          <ul>
            <li>Chat en temps r√©el (Socket.IO)</li>
            <li>Messagerie entre utilisateurs</li>
          </ul>
        </div>

        <div class="feature-category">
          <h3>Administration</h3>
          <ul>
            <li>Gestion des cat√©gories de sport</li>
            <li>Gestion des comptes utilisateurs</li>
            <li>Mod√©ration du contenu</li>
          </ul>
        </div>
      </div>

      <p class="highlight">
        <strong>Partie la plus enrichissante :</strong> Le d√©veloppement du chat
        en temps r√©el avec Socket.IO √©tait une premi√®re pour moi. La
        documentation excellente m'a permis de comprendre rapidement les
        concepts et d'impl√©menter cette fonctionnalit√© avec succ√®s.
      </p>

      <div class="progress">
        <p>
          <strong>√âtat d'avancement :</strong> 70% des fonctionnalit√©s r√©alis√©es
        </p>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 70%"></div>
        </div>
      </div>
    </section>

    <!-- Architecture technique -->
    <div class="section">
      <section id="architecture" class="architecture-section">
        <h3>üèóÔ∏è Architecture technique</h3>

        <div class="diagram-container">
          <img
            src="../assets/stage/Diagram.png"
            alt="Diagramme d'architecture de l'application Euphron"
            class="architecture-diagram"
          />
          <p class="legend">
            (Figure 3 - Architecture globale de l'application)
          </p>
        </div>

        <div class="architecture-explanation">
          <p>
            L'architecture de l'application repose sur une
            <strong>s√©paration claire</strong> entre le frontend, d√©velopp√© avec
            Quasar/Vue.js, et le backend, construit autour d'Express, Socket.io
            et MySQL.
          </p>

          <div class="flow-description">
            <h4>üîÑ Flux de donn√©es classiques (HTTP)</h4>
            <p>
              Lorsqu'un utilisateur interagit avec l'interface via son
              navigateur, ses actions sont prises en charge par les
              <strong>composants Vue</strong>, qui orchestrent l'affichage et la
              logique de l'application. Ces composants, lorsqu'ils ont besoin
              d'acc√©der √† des donn√©es ou de d√©clencher des op√©rations c√¥t√©
              serveur, font appel √† des
              <strong>services JavaScript d√©di√©s</strong>. Pour les √©changes
              classiques, comme la r√©cup√©ration ou la modification de donn√©es
              (gestion des utilisateurs ou des articles), ces services utilisent
              <strong>Axios</strong> pour envoyer des requ√™tes HTTP au serveur
              Express.
            </p>
            <p>
              Ce dernier re√ßoit les requ√™tes via ses
              <strong>routes REST</strong>, traite la logique m√©tier √† travers
              des services Node.js, puis interagit avec la
              <strong>base de donn√©es MySQL</strong> pour lire ou √©crire les
              informations n√©cessaires. Une fois l'op√©ration termin√©e, la
              r√©ponse est renvoy√©e au frontend sous forme de donn√©es JSON,
              permettant √† l'interface de se mettre √† jour en cons√©quence.
            </p>
          </div>

          <div class="flow-description">
            <h4>‚ö° Communication temps r√©el (WebSockets)</h4>
            <p>
              Parall√®lement √† ce fonctionnement traditionnel, l'application
              int√®gre √©galement une dimension temps r√©el gr√¢ce √†
              <strong>Socket.io</strong>. Pour des fonctionnalit√©s comme le chat
              ou les notifications instantan√©es, les composants Vue communiquent
              avec le serveur via le <strong>client Socket.io</strong>, qui
              √©tablit une connexion WebSocket persistante.
            </p>
            <p>
              Les √©v√©nements √©mis par le frontend sont capt√©s par le
              <strong>serveur Socket.io</strong>, qui peut alors traiter ces
              messages, √©ventuellement interagir avec la base de donn√©es, puis
              redistribuer les informations en temps r√©el √† tous les clients
              concern√©s.
            </p>
          </div>

          <div class="architecture-summary">
            <p>
              <strong>R√©sultat :</strong> L'ensemble du syst√®me permet √† la fois
              une gestion efficace des donn√©es via des requ√™tes HTTP classiques
              et une communication instantan√©e gr√¢ce aux WebSockets, offrant √†
              l'utilisateur une <strong>exp√©rience fluide et r√©active</strong>.
            </p>
          </div>
        </div>
      </section>
    </div>

    <!-- 6. D√©fis techniques rencontr√©s -->
    <section id="defis" class="section">
      <h2>üîß D√©fis techniques rencontr√©s</h2>

      <div class="challenge">
        <h3>Int√©gration Capacitor</h3>
        <p>
          <strong>Probl√®me :</strong> Pour tester l'application mobile, je
          devais la connecter au serveur local. Malgr√© mes tentatives de
          cr√©ation d'une adresse accessible via le r√©seau local, cette
          int√©gration s'est r√©v√©l√©e probl√©matique.
        </p>
        <p>
          <strong>Solution :</strong> J'ai mis cette partie de c√¥t√© pour me
          concentrer sur le d√©veloppement des fonctionnalit√©s core, tout en
          maintenant la compatibilit√© mobile.
        </p>
      </div>

      <div class="challenge">
        <h3>Tests utilisateurs limit√©s</h3>
        <p>
          Seule une dizaine d'utilisateurs (√©tudiants STAPS et √©quipe BU) ont pu
          tester l'application en raison du manque de peaufinage √† ce stade du
          d√©veloppement.
        </p>
      </div>
    </section>

    <!-- 7. S√©curit√© et bonnes pratiques -->
    <section id="securite" class="section">
      <h2>
        üõ°Ô∏è S√©curit√© et bonnes pratiques (<a
          @click="scrollToSection('ue4')"
          class="ue4-link"
          >UE4</a
        >)
      </h2>
      <p>
        Durant le d√©veloppement, j'ai appris l'importance de la s√©curisation
        contre les injections SQL. J'ai impl√©ment√© une double protection :
      </p>

      <div class="security-method">
        <h3>1. V√©rification frontend (Regex)</h3>
        <img src="../assets/stage/RegexCheck.png" alt="V√©rification Regex" />
        <p class="legend">(Figure 1 - Syst√®me de validation regex)</p>
        <p>
          Cette m√©thode c√¥t√© frontend v√©rifie que l'utilisateur n'essaie pas de
          nuire au fonctionnement de l'application en utilisant une
          <strong>EX</strong>pression <strong>R√âG</strong>uli√®re
          (<strong>REGEX</strong>). Cette expression v√©rifie que les champs
          (nom, email, t√©l√©phone) ne contiennent pas de caract√®res suspects
          comme <span class="special-character"> ' " ; -- / * </span> , etc.
          Elle refuse √©galement toute cha√Æne contenant des mots-cl√©s SQL
          classiques (<span class="special-character">SELECT</span>,
          <span class="special-character">DROP</span>,
          <span class="special-character">INSERT</span>, etc.). Cependant, le
          contr√¥le c√¥t√© frontend n‚Äôest qu‚Äôun confort pour l'utilisateur. Il est
          imp√©ratif de v√©rifier √©galement c√¥t√© backend, ce qui peut √™tre fait
          gr√¢ce aux requ√™tes pr√©par√©es.
        </p>
      </div>

      <div class="security-method">
        <h3>2. Requ√™tes pr√©par√©es (Backend)</h3>
        <img src="../assets/stage/PreparedQuery.png" alt="Requ√™tes pr√©par√©es" />
        <p class="legend">(Figure 2 - Impl√©mentation des requ√™tes pr√©par√©es)</p>
        <p>
          Les <strong>requ√™tes pr√©par√©es</strong> (ou param√©tr√©es) offrent une
          protection robuste car elles :
        </p>
        <ul>
          <li>Emp√™chent les injections SQL</li>
          <li>Sont support√©es par tous les moteurs SQL modernes</li>
          <li>Constituent la base de tous les ORM modernes</li>
        </ul>
      </div>
    </section>

    <!-- 8. √âtat d'avancement et suite √† donner -->
    <section id="avancement" class="section">
      <h2>üöÄ √âtat d'avancement et suite √† donner</h2>

      <div class="status">
        <h3>Actuellement en d√©veloppement</h3>
        <p>
          L'application n'a pas encore √©t√© mise en production, n√©cessitant
          encore du peaufinage et le d√©veloppement des fonctionnalit√©s
          restantes.
        </p>
      </div>

      <div class="remaining-tasks">
        <h3>Fonctionnalit√©s restantes</h3>
        <ul>
          <li>Gestion compl√®te des articles en tant qu'admin</li>
          <li>Am√©lioration de la gestion utilisateurs (administration)</li>
          <li>Peaufinage du syst√®me de chat en temps r√©el</li>
        </ul>
      </div>

      <div class="proposals">
        <h3>Mes propositions d'am√©lioration</h3>
        <ul>
          <li>
            <strong>Optimisation stockage :</strong> Passage √† deux bases de
            donn√©es si le stockage des images devient probl√©matique (s√©paration
            des donn√©es)
          </li>
          <li>
            <strong>Performance chat :</strong> Migration du chat vers MongoDB
            pour am√©liorer l'efficacit√© des messages temps r√©el
          </li>
        </ul>
      </div>

      <p>
        J'ai laiss√© un document complet "suite √† donner" r√©pertoriant mes
        r√©alisations, les t√¢ches restantes et mes recommandations techniques.
      </p>
    </section>

    <!-- 9. Apprentissages et retour d'exp√©rience -->
    <section id="apprentissages" class="section">
      <h2>üéì Apprentissages et retour d'exp√©rience</h2>

      <div class="learnings">
        <h3>Comp√©tences techniques acquises</h3>
        <ul>
          <li>
            Ma√Ætrise de <strong>Socket.IO</strong> pour la communication temps
            r√©el
          </li>
          <li>
            Approfondissement de la <strong>s√©curit√© web</strong> (injections
            SQL, requ√™tes pr√©par√©es)
          </li>
          <li>
            Exp√©rience compl√®te du <strong>d√©veloppement full-stack</strong>
          </li>
          <li>
            Utilisation de <strong>Quasar</strong> pour le d√©veloppement mobile
          </li>
        </ul>
      </div>

      <div class="learnings">
        <h3>Comp√©tences transversales</h3>
        <ul>
          <li>
            <strong>Autonomie</strong> dans la gestion d'un projet complet
          </li>
          <li>
            <strong>Adaptabilit√©</strong> face aux changements de sp√©cifications
          </li>
          <li><strong>Communication client</strong> et gestion des attentes</li>
          <li>
            <strong>Prise d'initiatives</strong> et propositions d'am√©liorations
          </li>
        </ul>
      </div>

      <div class="reflection">
        <h3>Si c'√©tait √† refaire</h3>
        <p>
          J'aurais pr√©f√©r√© travailler en √©quipe pour plus d'efficacit√©. En √©tant
          seul, je n'ai pas pu r√©aliser autant de fonctionnalit√©s que souhait√©,
          bien que cela m'ait permis de d√©velopper mon autonomie et ma capacit√©
          √† g√©rer un projet dans sa globalit√©.
        </p>
      </div>
    </section>

    <!-- 10. Comp√©tences cibl√©es -->
    <section id="comp√©tences" class="section">
      <h2>üß† Comp√©tences cibl√©es</h2>
      <p>
        Durant ce stage, j'ai cibl√© sp√©cifiquement plusieurs comp√©tences du
        <a
          href="https://www.enseignementsup-recherche.gouv.fr/sites/default/files/annexe-2-licence-professionnelle-bachelor-universitaire-de-technologie-informatique-29016.pdf#page=17"
          target="_blank"
          class="official-link"
        >
          r√©f√©rentiel officiel du B.U.T. Informatique</a
        >
        en fonction des missions qui m'ont √©t√© confi√©es :
      </p>

      <div class="competences-grid">
        <div class="competence-card ue1" id="ue1">
          <div class="competence-header">
            <span class="ue-badge">UE1</span>
            <h3>R√©aliser</h3>
          </div>
          <div class="competence-title">
            <span>√âlaborer une application informatique</span>
          </div>
          <div class="competence-details">
            <p><strong>Mise en application :</strong></p>
            <ul>
              <li>Conception compl√®te de l'application Euphron sur Figma</li>
              <li>D√©veloppement frontend avec Vue.js et Quasar</li>
              <li>Architecture backend avec Node.js et Express</li>
              <li>Int√©gration de fonctionnalit√©s temps r√©el (Socket.IO)</li>
            </ul>
          </div>
        </div>

        <div class="competence-card ue4" id="ue4">
          <div class="competence-header">
            <span class="ue-badge">UE4</span>
            <h3>Administrer</h3>
          </div>
          <div class="competence-title"><span>S√©curiser des donn√©es</span></div>
          <div class="competence-details">
            <p><strong>Mise en application :</strong></p>
            <ul>
              <li>
                Impl√©mentation de requ√™tes pr√©par√©es contre les injections SQL
              </li>
              <li>Validation des donn√©es c√¥t√© frontend (regex)</li>
              <li>Syst√®me d'authentification s√©curis√©</li>
            </ul>
          </div>
        </div>

        <div class="competence-card ue6" id="ue6">
          <div class="competence-header">
            <span class="ue-badge">UE6</span>
            <h3>Collaborer</h3>
          </div>
          <div class="competence-title">
            <span>√âlaborer, g√©rer et transmettre de l'information</span>
          </div>
          <div class="competence-details">
            <p><strong>Mise en application :</strong></p>
            <ul>
              <li>Communication r√©guli√®re avec l'√©quipe de la BU</li>
              <li>Pr√©sentation des avancements lors des r√©unions</li>
              <li>R√©daction du document "suite √† donner"</li>
            </ul>
          </div>
        </div>

        <div class="competence-card transverse" id="transverse">
          <div class="competence-header">
            <span class="ue-badge multi">UE4-5-6</span>
            <h3>Transverse</h3>
          </div>
          <div class="competence-title">
            <span>Lancer un nouveau projet</span>
          </div>
          <div class="competence-details">
            <p><strong>Mise en application :</strong></p>
            <ul>
              <li>Prise d'initiative pour l'architecture technique</li>
              <li>Gestion autonome du planning et des priorit√©s</li>
              <li>Adaptation aux changements de sp√©cifications</li>
              <li>Propositions d'am√©liorations futures</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="competences-synthesis">
        <h3>Synth√®se des apprentissages</h3>
        <p>
          Ce stage m'a permis de mettre en pratique de mani√®re concr√®te les
          comp√©tences th√©oriques et pratiques acquises durant ma formation.
          L'autonomie compl√®te sur le projet m'a particuli√®rement aid√© √†
          d√©velopper les aspects transversaux comme la gestion de projet et la
          communication client, tout en approfondissant mes comp√©tences
          techniques en d√©veloppement full-stack et en s√©curit√©.
        </p>
      </div>
    </section>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from "vue";

const activeSection = ref("contexte");

// Fonction pour faire d√©filer vers une section avec offset
const scrollToSection = (sectionId) => {
  const element = document.getElementById(sectionId);
  if (element) {
    const navbarHeight = 100;
    const elementPosition =
      element.getBoundingClientRect().top + window.pageYOffset;
    const offsetPosition = elementPosition - navbarHeight;

    window.scrollTo({
      top: offsetPosition,
      behavior: "smooth",
    });
  }
};

const handleScroll = () => {
  const sections = [
    "contexte",
    "role",
    "organisation",
    "technologies",
    "fonctionnalites",
    "architecture",
    "defis",
    "securite",
    "avancement",
    "apprentissages",
    "comp√©tences",
    "ue1",
    "ue4",
    "ue6",
    "transverse",
  ];

  for (let i = sections.length - 1; i >= 0; i--) {
    const element = document.getElementById(sections[i]);
    if (element) {
      const rect = element.getBoundingClientRect();
      if (rect.top <= 200) {
        activeSection.value = sections[i];
        break;
      }
    }
  }
};

onMounted(() => {
  // Smooth scroll pour tous les navigateurs
  document.documentElement.style.scrollBehavior = "smooth";

  window.addEventListener("scroll", handleScroll);
  handleScroll(); // Initial check
});

onUnmounted(() => {
  window.removeEventListener("scroll", handleScroll);
});
</script>

<style scoped>
.stage-view {
  font-family: "N27", sans-serif;
  color: #fff;
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  margin-top: 10rem;
  position: relative;
}

/* Navigation Scrollspy */
.scrollspy-nav {
  position: fixed;
  top: 50%;
  right: 2rem;
  transform: translateY(-50%);
  z-index: 1000;
  background: rgba(26, 26, 26, 0.9);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 16px;
  padding: 1rem;
  backdrop-filter: blur(20px);
  max-height: 80vh;
  overflow-y: auto;
  transition: all 0.3s ease;
}

.scrollspy-nav::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, #90a8ff, transparent);
}

.nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.nav-list li {
  margin-bottom: 0.5rem;
}

.nav-list a {
  display: block;
  padding: 0.75rem;
  color: #ccc;
  text-decoration: none;
  border-radius: 8px;
  font-size: 0.85rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.nav-list a::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(144, 168, 255, 0.1), transparent);
  transition: left 0.5s ease;
}

.nav-list a:hover::before {
  left: 100%;
}

.nav-list a:hover,
.nav-list a.active {
  background: rgba(144, 168, 255, 0.1);
  color: #90a8ff;
  border-left: 3px solid #90a8ff;
}

/* Sections */
.section {
  margin-bottom: 4rem;
  background: rgba(26, 26, 26, 0.6);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 20px;
  padding: 3rem 2rem;
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, #90a8ff, transparent);
}

.section h2 {
  font-size: 2rem;
  font-weight: 700;
  margin: 0 0 2rem 0;
  background: linear-gradient(135deg, #fff, #90a8ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-align: center;
}

.section h3 {
  color: #90a8ff;
  font-size: 1.3rem;
  font-weight: 600;
  margin: 2rem 0 1rem 0;
}

.section h4 {
  color: #90a8ff;
  font-size: 1.1rem;
  font-weight: 600;
  margin: 1.5rem 0 1rem 0;
}

.section p {
  line-height: 1.7;
  color: #e0e0e0;
  margin-bottom: 1rem;
}

.section ul {
  margin: 1rem 0;
  padding-left: 1.5rem;
}

.section li {
  line-height: 1.6;
  color: #e0e0e0;
  margin-bottom: 0.5rem;
}

/* Logo */
.logo {
  display: block;
  margin: 2rem auto;
  max-width: 200px;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(144, 168, 255, 0.2);
  transition: transform 0.3s ease;
}

.logo:hover {
  transform: scale(1.05);
}

/* Objectifs et contraintes */
.objectives {
  background: rgba(144, 168, 255, 0.05);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 16px;
  padding: 2rem;
  margin: 2rem 0;
  position: relative;
}

.objectives::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, #90a8ff, transparent);
}

.constraint {
  background: rgba(255, 107, 107, 0.1);
  border: 1px solid rgba(255, 107, 107, 0.2);
  border-radius: 12px;
  padding: 1rem;
  margin-top: 1rem;
  color: #ff6b6b;
}

/* Timeline */
.timeline {
  margin: 2rem 0;
}

.timeline-item {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
  padding: 1rem;
  background: rgba(144, 168, 255, 0.05);
  border-radius: 12px;
  border-left: 4px solid #90a8ff;
  transition: all 0.3s ease;
}

.timeline-item:hover {
  background: rgba(144, 168, 255, 0.1);
  transform: translateX(5px);
}

.week {
  font-weight: 600;
  color: #90a8ff;
  min-width: 120px;
  margin-right: 1rem;
}

.task {
  color: #e0e0e0;
}

/* Technologies */
.tech-stack {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin: 2rem 0;
}

.tech-category {
  background: rgba(144, 168, 255, 0.05);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 16px;
  padding: 2rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.tech-category::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, #90a8ff, transparent);
}

.tech-category:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 32px rgba(144, 168, 255, 0.15);
}

/* Fonctionnalit√©s */
.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin: 2rem 0;
}

.feature-category {
  background: rgba(144, 168, 255, 0.05);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 16px;
  padding: 1.5rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.feature-category::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, #90a8ff, transparent);
}

.feature-category:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 32px rgba(144, 168, 255, 0.15);
}

/* Highlight */
.highlight {
  background: rgba(144, 168, 255, 0.1);
  border: 1px solid rgba(144, 168, 255, 0.2);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 2rem 0;
  border-left: 4px solid #90a8ff;
}

/* Progress Bar */
.progress {
  margin: 2rem 0;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: rgba(144, 168, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin-top: 0.5rem;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #90a8ff, #7B68EE);
  border-radius: 4px;
  transition: width 1s ease;
}

/* Architecture */
.architecture-section {
  background: rgba(144, 168, 255, 0.05);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 20px;
  padding: 3rem 2rem;
  margin: 2rem 0;
  position: relative;
}

.architecture-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, #90a8ff, transparent);
}

.diagram-container {
  text-align: center;
  margin: 2rem 0;
}

.architecture-diagram {
  max-width: 100%;
  height: auto;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(144, 168, 255, 0.2);
  transition: transform 0.3s ease;
}

.architecture-diagram:hover {
  transform: scale(1.02);
}

.legend {
  font-style: italic;
  color: #aaa;
  font-size: 0.9rem;
  margin-top: 1rem;
}

.flow-description,
.architecture-explanation,
.architecture-summary {
  margin: 2rem 0;
}

/* D√©fis */
.challenge {
  background: rgba(255, 193, 7, 0.1);
  border: 1px solid rgba(255, 193, 7, 0.2);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 1.5rem 0;
  border-left: 4px solid #ffc107;
}

/* S√©curit√© */
.security-method {
  background: rgba(40, 167, 69, 0.1);
  border: 1px solid rgba(40, 167, 69, 0.2);
  border-radius: 16px;
  padding: 2rem;
  margin: 2rem 0;
  position: relative;
}

.security-method::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, #28a745, transparent);
}

.security-method img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 1rem 0;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

.special-character {
  background: rgba(255, 107, 107, 0.2);
  color: #ff6b6b;
  padding: 0.2rem 0.4rem;
  border-radius: 4px;
  font-family: monospace;
  font-weight: 600;
}

/* √âtat d'avancement */
.status,
.remaining-tasks,
.proposals {
  background: rgba(144, 168, 255, 0.05);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 1.5rem 0;
}

/* Apprentissages */
.learnings,
.reflection {
  background: rgba(144, 168, 255, 0.05);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 1.5rem 0;
}

/* Comp√©tences */
.competences-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin: 2rem 0;
}

.competence-card {
  border-radius: 16px;
  padding: 2rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.competence-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  transition: opacity 0.3s ease;
  opacity: 0;
}

.competence-card:hover::before {
  opacity: 1;
}

.competence-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
}

.competence-card.ue1 {
  background: rgba(74, 144, 226, 0.1);
  border: 1px solid rgba(74, 144, 226, 0.2);
}

.competence-card.ue1::before {
  background: linear-gradient(90deg, transparent, #4a90e2, transparent);
}

.competence-card.ue4 {
  background: rgba(46, 204, 113, 0.1);
  border: 1px solid rgba(46, 204, 113, 0.2);
}

.competence-card.ue4::before {
  background: linear-gradient(90deg, transparent, #2ecc71, transparent);
}

.competence-card.ue6 {
  background: rgba(230, 126, 34, 0.1);
  border: 1px solid rgba(230, 126, 34, 0.2);
}

.competence-card.ue6::before {
  background: linear-gradient(90deg, transparent, #e67e22, transparent);
}

.competence-card.transverse {
  background: rgba(155, 89, 182, 0.1);
  border: 1px solid rgba(155, 89, 182, 0.2);
}

.competence-card.transverse::before {
  background: linear-gradient(90deg, transparent, #9b59b6, transparent);
}

.competence-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.ue-badge {
  background: linear-gradient(135deg, #90a8ff, #7B68EE);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}

.ue-badge.multi {
  background: linear-gradient(135deg, #9b59b6, #8e44ad);
}

.competence-title {
  font-size: 1.1rem;
  color: #90a8ff;
  font-weight: 600;
  margin-bottom: 1rem;
}

.competence-details ul {
  margin: 0.5rem 0;
}

.competences-synthesis {
  background: rgba(144, 168, 255, 0.05);
  border: 1px solid rgba(144, 168, 255, 0.1);
  border-radius: 16px;
  padding: 2rem;
  margin: 3rem 0;
  text-align: center;
  position: relative;
}

.competences-synthesis::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, #90a8ff, transparent);
}

/* Liens */
.official-link,
.transverse-link,
.ue1-link,
.ue4-link {
  color: #90a8ff;
  text-decoration: none;
  font-weight: 600;
  position: relative;
  transition: all 0.3s ease;
}

.official-link:hover,
.transverse-link:hover,
.ue1-link:hover,
.ue4-link:hover {
  color: #fff;
  text-shadow: 0 0 8px #90a8ff;
}

.official-link::after,
.transverse-link::after,
.ue1-link::after,
.ue4-link::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 0;
  height: 2px;
  background: #90a8ff;
  transition: width 0.3s ease;
}

.official-link:hover::after,
.transverse-link:hover::after,
.ue1-link:hover::after,
.ue4-link:hover::after {
  width: 100%;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .scrollspy-nav {
    position: static;
    transform: none;
    margin-bottom: 2rem;
    max-height: none;
    overflow: visible;
  }
  
  .nav-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .nav-list li {
    margin-bottom: 0;
  }
  
  .nav-list a {
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
  }
}

@media (max-width: 768px) {
  .stage-view {
    padding: 1rem;
  }

  .section {
    padding: 2rem 1rem;
  }

  .section h2 {
    font-size: 1.5rem;
  }

  .tech-stack {
    grid-template-columns: 1fr;
  }

  .features-grid {
    grid-template-columns: 1fr;
  }

  .competences-grid {
    grid-template-columns: 1fr;
  }

  .timeline-item {
    flex-direction: column;
    text-align: center;
  }

  .week {
    min-width: auto;
    margin-right: 0;
    margin-bottom: 0.5rem;
  }
}

@media (max-width: 480px) {
  .section h2 {
    font-size: 1.3rem;
  }

  .objectives,
  .tech-category,
  .feature-category {
    padding: 1rem;
  }

  .competence-card {
    padding: 1.5rem;
  }
}

/* Scrollbar personnalis√©e */
.scrollspy-nav::-webkit-scrollbar {
  width: 4px;
}

.scrollspy-nav::-webkit-scrollbar-track {
  background: rgba(144, 168, 255, 0.1);
  border-radius: 2px;
}

.scrollspy-nav::-webkit-scrollbar-thumb {
  background: #90a8ff;
  border-radius: 2px;
}

/* Animation d'entr√©e */
.section {
  animation: fadeInUp 0.6s ease forwards;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Effet de focus pour l'accessibilit√© */
.nav-list a:focus,
.competence-card:focus {
  outline: 2px solid #90a8ff;
  outline-offset: 2px;
}
</style>
